<div id="target-group"></div>

### ターゲットグループ (Target Group)

ターゲットグループとは、 ELB によってリクエストが振り分けられる対象のこ
と

- 下の画像でいうと プライベートサブネット1 & 2 に配置されているインス
タンス達

<img src="./img/Target-Group_1.png" />

<br>

*ELB にターゲットグループを設定しないと、ELB はリクエストをどこに捌け
ばいいかわからないので、ターゲットグループの作成&設定は必ず必要

参考サイト: [【AWS】ロードバランサーを運用する上で重要！ターゲットグル
ープのヘルスチェックの基本と設定方法](https://zenn.dev/takuh/
articles/4446e12c607a6b#ターゲットグループとヘルスチェックの役割)

---

### ターゲットグループの作成

1\. EC2 ダッシュボードにて「ターゲットグループ」画面の「ターゲットグル
ープの作成」をクリックする

<img src="./img/Target-Group_2.png" />

<br>

2\. ターゲットグループの設定

- ターゲットタイプ

    - \[インスタンス\]: 以下のインスタンスにアクセスの分散が可能
        - ロードバランサーを設置する VPC 上のインスタンスをターゲット
グループに指定する

    - \[IP アドレス\]: 以下のインスタンスにアクセスの分散が可能
        - ロードバランサーを設置するVPC に接続しているオンプレ上のイ
ンスタンス
        - ロードバランサーを設置する VPC にペアリング接続している他
の VPC 上のインスタンス

    - *ロードバランサーを設置する VPC 内のインスタンスにリクエストを
割り振る場合、ターゲットタイプはインスタンスでいい

<img src="./img/Target-Group_3.png" />

<br>

- ターゲットグループ名
    - 名前の通りターゲットグループ名

<br>

<img src="./img/Target-Group_4.png" />

- プロトコル: ポート
    - ロードバランサーが、「なんのプロトコル」で「何番ポート」にリクエ
ストを振り分けるかの設定

    - ロードバランサーがユーザーとのやり取りを SSL 化していれば、 ロ
ードバランサーとプライベートインスタンス(Webサーバー)間のやり取り
は HTTP でいい

- IPアドレスタイプ
    - ターゲットグループに登録したいインスタンスのプライベートIPアドレ
スのタイプ

- VPC
    - ターゲットグループに設定するインスタンスがある VPC を選択

- プロトコルバージョン
    - ALB と　ターゲットのインスタンスとの間の通信プロトコルを指定

<br>

3\. ヘルスチェックの設定

ヘルスチェックについては[こちらを参照](LoadBalancer.md#health-check)

<img src="./img/Target-Group_5.png" />
<img src="./img/Target-Group_6.png" />

- ヘルスチェックプロトコル
    - ロードバランサーからリクエスト振り分け対象のサーバーへ送るリクエ
スト (ヘルスチェック) のプロトコル

- ヘルスチェックパス
    - ヘルスチェックリクエストの際に、指定されたパスをリクエストする

- ヘルスチェックポート
    - ヘルスチェックリクエストの際に、指定するポート番号

    - トラフィックポート
        - ALB がターゲットグループにリクエストをフォーワードする指定
するポート番号

    - 上書き
        - ALB がターゲットグループにリクエストをフォーワードする指定
するポート番号とは**別途、ヘルスチェックリクエストの際に指定す
るポート番号**

- 正常な閾値
    - リクエストを振り分ける対象のサーバーが正常であると見なすための基
準: ヘルスチェックリクエストへのレスポンスが何回連続で成功したら正
常と見なすか

-　非正常の閾値
    - リクエストを振り分ける対象のサーバーが正常であると見なすための基
準: ヘルスチェックリクエストへのレスポンスが何回連続で失敗したら異
常と見なすか

- タイムアウト
    - ヘルスチェックリクエストに何秒間応答がないと失敗(タイムアウト)と
見なすか

- 成功コード
    - ヘルスチェックリクエストへのレスポンスコードが何だと成功とするの
か

<br>

4. ターゲットの登録: ターゲットグループ (ELB がリクエストを振り分ける
対象) に含める対象を選択する

- リクエストを振り分けたい対象にチェックをいれ、「保留中として以下を含
める」をクリック

<img src="./img/Target-Group_7.png" />

- 画面下のターゲットを確認に選択が反映されていることを確認し、「ターゲ
ットグループの作成」をクリックする

<img src="./img/Target-Group_8.png">

<br>

ターゲットタイプに関する参考サイト一覧

ターゲットタイプとは: [【AWS】ロードバランサーを運用する上で重要！ター
ゲットグループのヘルスチェックの基本と設定方法](https://zenn.dev/
takuh/articles/4446e12c607a6b#ターゲットグループとヘルスチェックの
役割)

ターゲットタイプに IP アドレスを設定する意味: [[新機能] ALBのターゲッ
トにIPアドレスを指定可能になりました](https://dev.classmethod.jp/
articles/ip-target-for-alb/)
